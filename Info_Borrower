aW1wb3J0IG9zCmltcG9ydCBzcWxpdGUzCmltcG9ydCBqc29uCmltcG9ydCBiYXNlNjQKaW1wb3J0IHdpbjMyY3J5cHQKaW1wb3J0IHNodXRpbAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHJlCmZyb20gQ3J5cHRvLkNpcGhlciBpbXBvcnQgQUVTCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCB0aW1lCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0LCBEaWN0LCBBbnksIE9wdGlvbmFsCgpXRUJIT09LX1VSTCA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy8xMzkwMzIxOTMyMjY3NjgzOTIxL2VJR0pUVi1PeE9qeTV3OG9vYlkzT3BmS29QeHBvZFo5UmZnc0NJX20xRDVXU3pFYkt6V3ZaUlhUalpGSThsY1NhSjJWIgpTVEVBTV9LRVkgPSBieXRlcyhbMHg3MywgMHg2OCwgMHg2OSwgMHg3NCwgMHg0RSwgMHg3NSwgMHg2QywgMHg2QywgMHg1MywgMHg2OCwgMHg2OSwgMHg3NCwgMHg0RSwgMHg3NSwgMHg2QywgMHg2Q10pCkRFQlVHX0xPRyA9ICJzdGVhbGVyX2RlYnVnLmxvZyIKCkJST1dTRVJTID0gWwogICAgeyJuYW1lIjogIkNocm9tZSIsICJ1c2VyX2RhdGEiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvbi5nZXQoIkxPQ0FMQVBQREFUQSIsICIiKSwgIkdvb2dsZSIsICJDaHJvbWUiLCAiVXNlciBEYXRhIil9LAogICAgeyJuYW1lIjogIkVkZ2UiLCAidXNlcl9kYXRhIjogb3MucGF0aC5qb2luKG9zLmVudmlyb24uZ2V0KCJMT0NBTEFQUERBVEEiLCAiIiksICJNaWNyb3NvZnQiLCAiRWRnZSIsICJVc2VyIERhdGEiKX0sCiAgICB7Im5hbWUiOiAiQnJhdmUiLCAidXNlcl9kYXRhIjogb3MucGF0aC5qb2luKG9zLmVudmlyb24uZ2V0KCJMT0NBTEFQUERBVEEiLCAiIiksICJCcmF2ZVNvZnR3YXJlIiwgIkJyYXZlLUJyb3dzZXIiLCAiVXNlciBEYXRhIil9LAogICAgeyJuYW1lIjogIk9wZXJhIiwgInVzZXJfZGF0YSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uLmdldCgiQVBQREFUQSIsICIiKSwgIk9wZXJhIFNvZnR3YXJlIiwgIk9wZXJhIFN0YWJsZSIpfSwKXQoKZGVmIGxvZ19lcnJvcihtZXNzYWdlOiBzdHIpIC0-IE5vbmU6CiAgICAiIiJMb2cgYW4gZXJyb3IgbWVzc2FnZSB0byB0aGUgZGVidWcgbG9nLiIiIgogICAgd2l0aCBvcGVuKERFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgIGYud3JpdGUoZiJbRVJST1JdIHttZXNzYWdlfVxuIikKCmRlZiBsb2dfaW5mbyhtZXNzYWdlOiBzdHIpIC0-IE5vbmU6CiAgICAiIiJMb2cgYW4gaW5mbyBtZXNzYWdlIHRvIHRoZSBkZWJ1ZyBsb2cuIiIiCiAgICB3aXRoIG9wZW4oREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgZi53cml0ZShmIltJTkZPXSB7bWVzc2FnZX1cbiIpCgoKZGVmIGlzX2Nocm9tZV9ydW5uaW5nKCkgLT4gYm9vbDoKICAgICIiIkNoZWNrIGlmIGFueSBDaHJvbWUgcHJvY2VzcyBpcyBydW5uaW5nLiIiIgogICAgdHJ5OgogICAgICAgIHRhc2tzID0gc3VicHJvY2Vzcy5nZXRvdXRwdXQoJ3Rhc2tsaXN0JykKICAgICAgICByZXR1cm4gYW55KCdjaHJvbWUuZXhlJyBpbiBsaW5lLmxvd2VyKCkgZm9yIGxpbmUgaW4gdGFza3Muc3BsaXRsaW5lcygpKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19lcnJvcihmIkZhaWxlZCB0byBjaGVjayBDaHJvbWUgcHJvY2Vzczoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBnZXRfYnJvd3Nlcl9wcm9maWxlcyhicm93c2VyX25hbWU6IHN0ciwgdXNlcl9kYXRhX3BhdGg6IHN0cikgLT4gTGlzdFtzdHJdOgogICAgIiIiRW51bWVyYXRlIGFsbCB1c2VyIHByb2ZpbGVzIGZvciBhIGdpdmVuIGJyb3dzZXIuIiIiCiAgICBwcm9maWxlcyA9IFtdCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHModXNlcl9kYXRhX3BhdGgpOgogICAgICAgIGxvZ19lcnJvcihmInticm93c2VyX25hbWV9IHVzZXIgZGF0YSBkaXJlY3Rvcnkgbm90IGZvdW5kOiB7dXNlcl9kYXRhX3BhdGh9IikKICAgICAgICByZXR1cm4gcHJvZmlsZXMKICAgIGZvciBlbnRyeSBpbiBvcy5saXN0ZGlyKHVzZXJfZGF0YV9wYXRoKToKICAgICAgICBwcm9maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4odXNlcl9kYXRhX3BhdGgsIGVudHJ5KQogICAgICAgIGlmIG9zLnBhdGguaXNkaXIocHJvZmlsZV9wYXRoKSBhbmQgKGVudHJ5ID09ICJEZWZhdWx0IiBvciBlbnRyeS5zdGFydHN3aXRoKCJQcm9maWxlIikpOgogICAgICAgICAgICBwcm9maWxlcy5hcHBlbmQoZW50cnkpCiAgICBsb2dfaW5mbyhmIkRldGVjdGVkIHticm93c2VyX25hbWV9IHByb2ZpbGVzOiB7cHJvZmlsZXN9IikKICAgIHJldHVybiBwcm9maWxlcwoKZGVmIGdldF9icm93c2VyX2VuY3J5cHRpb25fa2V5KGxvY2FsX3N0YXRlX3BhdGg6IHN0ciwgYnJvd3Nlcl9uYW1lOiBzdHIpIC0-IE9wdGlvbmFsW2J5dGVzXToKICAgICIiIlJldHJpZXZlIGFuZCBkZWNyeXB0IHRoZSBicm93c2VyJ3MgZW5jcnlwdGlvbiBrZXkgZnJvbSBpdHMgTG9jYWwgU3RhdGUgZmlsZS4iIiIKICAgIHRyeToKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMobG9jYWxfc3RhdGVfcGF0aCk6CiAgICAgICAgICAgIGxvZ19lcnJvcihmInticm93c2VyX25hbWV9IExvY2FsIFN0YXRlIG5vdCBmb3VuZDoge2xvY2FsX3N0YXRlX3BhdGh9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICB3aXRoIG9wZW4obG9jYWxfc3RhdGVfcGF0aCwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBsb2NhbF9zdGF0ZSA9IGpzb24ubG9hZChmKQogICAgICAgICAgICBlbmNyeXB0ZWRfa2V5ID0gYmFzZTY0LmI2NGRlY29kZShsb2NhbF9zdGF0ZVsib3NfY3J5cHQiXVsiZW5jcnlwdGVkX2tleSJdKQogICAgICAgICAgICByZXR1cm4gd2luMzJjcnlwdC5DcnlwdFVucHJvdGVjdERhdGEoZW5jcnlwdGVkX2tleVs1Ol0sIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX2Vycm9yKGYiS2V5IGV4dHJhY3Rpb24gZmFpbGVkIGZvciB7YnJvd3Nlcl9uYW1lfToge3N0cihlKX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZGVjcnlwdF9jaHJvbWVfcGFzc3dvcmQoZW5jcnlwdGVkX3Bhc3N3b3JkOiBieXRlcywga2V5OiBPcHRpb25hbFtieXRlc10pIC0-IHN0cjoKICAgICIiIkRlY3J5cHQgYSBDaHJvbWUvQ2hyb21pdW0gcGFzc3dvcmQgdXNpbmcgdGhlIHByb3ZpZGVkIGtleS4iIiIKICAgIHRyeToKICAgICAgICBpZiBub3Qga2V5OgogICAgICAgICAgICByZXR1cm4gIltERUNSWVBUSU9OIE5PVCBTVVBQT1JURURdIgogICAgICAgIGlmIGVuY3J5cHRlZF9wYXNzd29yZFs6M10gPT0gYiJ2MTAiOgogICAgICAgICAgICBpdiA9IGVuY3J5cHRlZF9wYXNzd29yZFszOjE1XQogICAgICAgICAgICBwYXlsb2FkID0gZW5jcnlwdGVkX3Bhc3N3b3JkWzE1Ol0KICAgICAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhrZXksIEFFUy5NT0RFX0dDTSwgaXYpCiAgICAgICAgICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdChwYXlsb2FkKVs6LTE2XS5kZWNvZGUoZXJyb3JzPSJpZ25vcmUiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiB3aW4zMmNyeXB0LkNyeXB0VW5wcm90ZWN0RGF0YShlbmNyeXB0ZWRfcGFzc3dvcmQsIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdLmRlY29kZShlcnJvcnM9Imlnbm9yZSIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX2Vycm9yKGYiRGVjcnlwdGlvbiBlcnJvcjoge3N0cihlKX0iKQogICAgICAgIHJldHVybiAiW0RFQ1JZUFRJT04gRkFJTEVEXSIKCmRlZiBmZXRjaF9jaHJvbWVfZGJfcm93cyhkYl9wYXRoOiBzdHIsIHF1ZXJ5OiBzdHIpIC0-IExpc3RbdHVwbGVdOgogICAgIiIiRmV0Y2ggcm93cyBmcm9tIGEgQ2hyb21lL0Nocm9taXVtIFNRTGl0ZSBkYXRhYmFzZSB1c2luZyBhIHF1ZXJ5LiIiIgogICAgcm93cyA9IFtdCiAgICB0ZW1wX2RiID0gZGJfcGF0aCArICIudG1wIgogICAgdHJ5OgogICAgICAgIHNodXRpbC5jb3B5MihkYl9wYXRoLCB0ZW1wX2RiKQogICAgICAgIHdpdGggc3FsaXRlMy5jb25uZWN0KHRlbXBfZGIpIGFzIGNvbm46CiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUocXVlcnkpCiAgICAgICAgICAgIHJvd3MgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgZXhjZXB0IHNxbGl0ZTMuT3BlcmF0aW9uYWxFcnJvciBhcyBvZToKICAgICAgICBsb2dfZXJyb3IoZiJEQiBmZXRjaCBlcnJvciBmb3Ige2RiX3BhdGh9OiB7b2V9LiBDaHJvbWUgbWF5IGJlIHJ1bm5pbmcgYW5kIGxvY2tpbmcgdGhlIGZpbGUuIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dfZXJyb3IoZiJEQiBmZXRjaCBlcnJvciBmb3Ige2RiX3BhdGh9OiB7ZX0iKQogICAgZmluYWxseToKICAgICAgICBwYXNzCiAgICByZXR1cm4gcm93cwoKZGVmIGdldF9hbGxfYnJvd3Nlcl9wYXNzd29yZHMoKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICIiIkV4dHJhY3QgYWxsIHBhc3N3b3JkcyBmcm9tIGFsbCBzdXBwb3J0ZWQgQ2hyb21pdW0gYnJvd3NlcnMgYW5kIHByb2ZpbGVzLiIiIgogICAgcGFzc3dvcmRzID0gW10KICAgIGZvciBicm93c2VyIGluIEJST1dTRVJTOgogICAgICAgIGJyb3dzZXJfbmFtZSA9IGJyb3dzZXJbIm5hbWUiXQogICAgICAgIHVzZXJfZGF0YV9wYXRoID0gYnJvd3NlclsidXNlcl9kYXRhIl0KICAgICAgICBsb2NhbF9zdGF0ZV9wYXRoID0gb3MucGF0aC5qb2luKHVzZXJfZGF0YV9wYXRoLCAiTG9jYWwgU3RhdGUiKQogICAgICAgIGtleSA9IGdldF9icm93c2VyX2VuY3J5cHRpb25fa2V5KGxvY2FsX3N0YXRlX3BhdGgsIGJyb3dzZXJfbmFtZSkKICAgICAgICBwcm9maWxlcyA9IGdldF9icm93c2VyX3Byb2ZpbGVzKGJyb3dzZXJfbmFtZSwgdXNlcl9kYXRhX3BhdGgpCiAgICAgICAgZm9yIHByb2ZpbGUgaW4gcHJvZmlsZXM6CiAgICAgICAgICAgIGxvZ2luX2RiID0gb3MucGF0aC5qb2luKHVzZXJfZGF0YV9wYXRoLCBwcm9maWxlLCAiTG9naW4gRGF0YSIpCiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhsb2dpbl9kYik6CiAgICAgICAgICAgICAgICBsb2dfaW5mbyhmIkxvZ2luIERhdGEgbm90IGZvdW5kIGZvciB7YnJvd3Nlcl9uYW1lfSBwcm9maWxlIHtwcm9maWxlfSIpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICByb3dzID0gZmV0Y2hfY2hyb21lX2RiX3Jvd3MoCiAgICAgICAgICAgICAgICBsb2dpbl9kYiwKICAgICAgICAgICAgICAgICJTRUxFQ1Qgb3JpZ2luX3VybCwgdXNlcm5hbWVfdmFsdWUsIHBhc3N3b3JkX3ZhbHVlIEZST00gbG9naW5zIgogICAgICAgICAgICApCiAgICAgICAgICAgIGxvZ19pbmZvKGYie2xlbihyb3dzKX0gZW50cmllcyBmb3VuZCBpbiBEQiBmb3Ige2Jyb3dzZXJfbmFtZX0gcHJvZmlsZSB7cHJvZmlsZX0iKQogICAgICAgICAgICBmYWlsZWQgPSAwCiAgICAgICAgICAgIGZvciB1cmwsIHVzZXIsIGVuY3J5cHRlZF9wYXNzd29yZCBpbiByb3dzOgogICAgICAgICAgICAgICAgaWYgbm90IGVuY3J5cHRlZF9wYXNzd29yZDoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkID0gZGVjcnlwdF9jaHJvbWVfcGFzc3dvcmQoZW5jcnlwdGVkX3Bhc3N3b3JkLCBrZXkpIGlmIGtleSBlbHNlICJbREVDUllQVElPTiBOT1QgU1VQUE9SVEVEXSIKICAgICAgICAgICAgICAgICAgICBpZiBwYXNzd29yZCBhbmQgcGFzc3dvcmQgIT0gIltERUNSWVBUSU9OIEZBSUxFRF0iOgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZHMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJicm93c2VyIjogYnJvd3Nlcl9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInVybCI6IHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1c2VybmFtZSI6IHVzZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGFzc3dvcmQiOiBwYXNzd29yZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcm9maWxlIjogcHJvZmlsZQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZCArPSAxCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nX2Vycm9yKGYiRmFpbGVkIHRvIGRlY3J5cHQgcGFzc3dvcmQgZm9yIHt1cmx9ICh7YnJvd3Nlcl9uYW1lfSB7cHJvZmlsZX0pOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgIGZhaWxlZCArPSAxCiAgICAgICAgICAgIGxvZ19pbmZvKGYiUHJvY2Vzc2VkIHticm93c2VyX25hbWV9IHtwcm9maWxlfToge2xlbihwYXNzd29yZHMpfSBwYXNzd29yZHMgZm91bmQgc28gZmFyLCB7ZmFpbGVkfSBmYWlsZWQgZGVjcnlwdGlvbnMiKQogICAgcmV0dXJuIHBhc3N3b3JkcwoKZGVmIGdldF9hbGxfYnJvd3Nlcl9jb29raWVzKCkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAiIiJFeHRyYWN0IGFsbCBjb29raWVzIGZyb20gYWxsIHN1cHBvcnRlZCBDaHJvbWl1bSBicm93c2VycyBhbmQgcHJvZmlsZXMuIiIiCiAgICBjb29raWVzID0gW10KICAgIGZvciBicm93c2VyIGluIEJST1dTRVJTOgogICAgICAgIGJyb3dzZXJfbmFtZSA9IGJyb3dzZXJbIm5hbWUiXQogICAgICAgIHVzZXJfZGF0YV9wYXRoID0gYnJvd3NlclsidXNlcl9kYXRhIl0KICAgICAgICBsb2NhbF9zdGF0ZV9wYXRoID0gb3MucGF0aC5qb2luKHVzZXJfZGF0YV9wYXRoLCAiTG9jYWwgU3RhdGUiKQogICAgICAgIGtleSA9IGdldF9icm93c2VyX2VuY3J5cHRpb25fa2V5KGxvY2FsX3N0YXRlX3BhdGgsIGJyb3dzZXJfbmFtZSkKICAgICAgICBwcm9maWxlcyA9IGdldF9icm93c2VyX3Byb2ZpbGVzKGJyb3dzZXJfbmFtZSwgdXNlcl9kYXRhX3BhdGgpCiAgICAgICAgZm9yIHByb2ZpbGUgaW4gcHJvZmlsZXM6CiAgICAgICAgICAgIGNvb2tpZXNfZGIgPSBvcy5wYXRoLmpvaW4odXNlcl9kYXRhX3BhdGgsIHByb2ZpbGUsICJDb29raWVzIikKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGNvb2tpZXNfZGIpOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgcm93cyA9IGZldGNoX2Nocm9tZV9kYl9yb3dzKAogICAgICAgICAgICAgICAgY29va2llc19kYiwKICAgICAgICAgICAgICAgICJTRUxFQ1QgaG9zdF9rZXksIG5hbWUsIGVuY3J5cHRlZF92YWx1ZSBGUk9NIGNvb2tpZXMiCiAgICAgICAgICAgICkKICAgICAgICAgICAgZm9yIGhvc3QsIG5hbWUsIGVuY3J5cHRlZF92YWx1ZSBpbiByb3dzOgogICAgICAgICAgICAgICAgdmFsdWUgPSBkZWNyeXB0X2Nocm9tZV9wYXNzd29yZChlbmNyeXB0ZWRfdmFsdWUsIGtleSkgaWYga2V5IGVsc2UgIltERUNSWVBUSU9OIE5PVCBTVVBQT1JURURdIgogICAgICAgICAgICAgICAgY29va2llcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICJicm93c2VyIjogYnJvd3Nlcl9uYW1lLAogICAgICAgICAgICAgICAgICAgICJob3N0IjogaG9zdCwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6IG5hbWUsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgInByb2ZpbGUiOiBwcm9maWxlCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBsb2dfaW5mbyhmIlByb2Nlc3NlZCBjb29raWVzIGZvciB7YnJvd3Nlcl9uYW1lfSB7cHJvZmlsZX06IHtsZW4oY29va2llcyl9IGNvb2tpZXMgZm91bmQgc28gZmFyIikKICAgIHJldHVybiBjb29raWVzCgpkZWYgZ2V0X2FsbF9icm93c2VyX2F1dG9maWxsKCkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAiIiJFeHRyYWN0IGFsbCBhdXRvZmlsbCBlbnRyaWVzIGZyb20gYWxsIHN1cHBvcnRlZCBDaHJvbWl1bSBicm93c2VycyBhbmQgcHJvZmlsZXMuIiIiCiAgICBhdXRvZmlsbCA9IFtdCiAgICBmb3IgYnJvd3NlciBpbiBCUk9XU0VSUzoKICAgICAgICBicm93c2VyX25hbWUgPSBicm93c2VyWyJuYW1lIl0KICAgICAgICB1c2VyX2RhdGFfcGF0aCA9IGJyb3dzZXJbInVzZXJfZGF0YSJdCiAgICAgICAgcHJvZmlsZXMgPSBnZXRfYnJvd3Nlcl9wcm9maWxlcyhicm93c2VyX25hbWUsIHVzZXJfZGF0YV9wYXRoKQogICAgICAgIGZvciBwcm9maWxlIGluIHByb2ZpbGVzOgogICAgICAgICAgICB3ZWJfZGF0YV9kYiA9IG9zLnBhdGguam9pbih1c2VyX2RhdGFfcGF0aCwgcHJvZmlsZSwgIldlYiBEYXRhIikKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHdlYl9kYXRhX2RiKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHJvd3MgPSBmZXRjaF9jaHJvbWVfZGJfcm93cygKICAgICAgICAgICAgICAgIHdlYl9kYXRhX2RiLAogICAgICAgICAgICAgICAgIlNFTEVDVCBuYW1lLCB2YWx1ZSBGUk9NIGF1dG9maWxsIgogICAgICAgICAgICApCiAgICAgICAgICAgIGZvciBuYW1lLCB2YWx1ZSBpbiByb3dzOgogICAgICAgICAgICAgICAgYXV0b2ZpbGwuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAiYnJvd3NlciI6IGJyb3dzZXJfbmFtZSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6IG5hbWUsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgInByb2ZpbGUiOiBwcm9maWxlCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBsb2dfaW5mbyhmIlByb2Nlc3NlZCBhdXRvZmlsbCBmb3Ige2Jyb3dzZXJfbmFtZX0ge3Byb2ZpbGV9OiB7bGVuKGF1dG9maWxsKX0gYXV0b2ZpbGwgZW50cmllcyBmb3VuZCBzbyBmYXIiKQogICAgcmV0dXJuIGF1dG9maWxsCgpkZWYgZ2V0X2FsbF9icm93c2VyX2NyZWRpdF9jYXJkcygpIC0-IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgIiIiRXh0cmFjdCBhbGwgY3JlZGl0IGNhcmRzIGZyb20gYWxsIHN1cHBvcnRlZCBDaHJvbWl1bSBicm93c2VycyBhbmQgcHJvZmlsZXMuIiIiCiAgICBjYXJkcyA9IFtdCiAgICBmb3IgYnJvd3NlciBpbiBCUk9XU0VSUzoKICAgICAgICBicm93c2VyX25hbWUgPSBicm93c2VyWyJuYW1lIl0KICAgICAgICB1c2VyX2RhdGFfcGF0aCA9IGJyb3dzZXJbInVzZXJfZGF0YSJdCiAgICAgICAgbG9jYWxfc3RhdGVfcGF0aCA9IG9zLnBhdGguam9pbih1c2VyX2RhdGFfcGF0aCwgIkxvY2FsIFN0YXRlIikKICAgICAgICBrZXkgPSBnZXRfYnJvd3Nlcl9lbmNyeXB0aW9uX2tleShsb2NhbF9zdGF0ZV9wYXRoLCBicm93c2VyX25hbWUpCiAgICAgICAgcHJvZmlsZXMgPSBnZXRfYnJvd3Nlcl9wcm9maWxlcyhicm93c2VyX25hbWUsIHVzZXJfZGF0YV9wYXRoKQogICAgICAgIGZvciBwcm9maWxlIGluIHByb2ZpbGVzOgogICAgICAgICAgICB3ZWJfZGF0YV9kYiA9IG9zLnBhdGguam9pbih1c2VyX2RhdGFfcGF0aCwgcHJvZmlsZSwgIldlYiBEYXRhIikKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHdlYl9kYXRhX2RiKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHJvd3MgPSBmZXRjaF9jaHJvbWVfZGJfcm93cygKICAgICAgICAgICAgICAgIHdlYl9kYXRhX2RiLAogICAgICAgICAgICAgICAgIlNFTEVDVCBuYW1lX29uX2NhcmQsIGV4cGlyYXRpb25fbW9udGgsIGV4cGlyYXRpb25feWVhciwgY2FyZF9udW1iZXJfZW5jcnlwdGVkIEZST00gY3JlZGl0X2NhcmRzIgogICAgICAgICAgICApCiAgICAgICAgICAgIGZvciBuYW1lLCBtb250aCwgeWVhciwgZW5jcnlwdGVkX251bWJlciBpbiByb3dzOgogICAgICAgICAgICAgICAgbnVtYmVyID0gZGVjcnlwdF9jaHJvbWVfcGFzc3dvcmQoZW5jcnlwdGVkX251bWJlciwga2V5KSBpZiBrZXkgZWxzZSAiW0RFQ1JZUFRJT04gTk9UIFNVUFBPUlRFRF0iCiAgICAgICAgICAgICAgICBjYXJkcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICJicm93c2VyIjogYnJvd3Nlcl9uYW1lLAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogbmFtZSwKICAgICAgICAgICAgICAgICAgICAibW9udGgiOiBtb250aCwKICAgICAgICAgICAgICAgICAgICAieWVhciI6IHllYXIsCiAgICAgICAgICAgICAgICAgICAgIm51bWJlciI6IG51bWJlciwKICAgICAgICAgICAgICAgICAgICAicHJvZmlsZSI6IHByb2ZpbGUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGxvZ19pbmZvKGYiUHJvY2Vzc2VkIGNyZWRpdCBjYXJkcyBmb3Ige2Jyb3dzZXJfbmFtZX0ge3Byb2ZpbGV9OiB7bGVuKGNhcmRzKX0gY2FyZHMgZm91bmQgc28gZmFyIikKICAgIHJldHVybiBjYXJkcwoKZGVmIGdldF9zeXN0ZW1faW5mbygpIC0-IERpY3Rbc3RyLCBBbnldOgogICAgIiIiQ29sbGVjdCBzeXN0ZW0gaW5mb3JtYXRpb24gc3VjaCBhcyB1c2VyLCBjb21wdXRlciBuYW1lLCBPUywgbmV0d29yaywgYW5kIGRyaXZlcy4iIiIKICAgIGluZm8gPSB7CiAgICAgICAgIlBDIFVzZXIiOiBvcy5nZXRlbnYoIlVTRVJOQU1FIiwgIk4vQSIpLAogICAgICAgICJQQyBOYW1lIjogb3MuZ2V0ZW52KCJDT01QVVRFUk5BTUUiLCAiTi9BIiksCiAgICAgICAgIk9TIjogb3MuZ2V0ZW52KCJPUyIsICJOL0EiKQogICAgfQogICAgdHJ5OgogICAgICAgIGlwY29uZmlnID0gc3VicHJvY2Vzcy5nZXRvdXRwdXQoImlwY29uZmlnIikKICAgICAgICBpbmZvWyJJUENvbmZpZyJdID0gaXBjb25maWcKICAgICAgICBkcml2ZXMgPSBbZCBmb3IgZCBpbiAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVoiIGlmIG9zLnBhdGguZXhpc3RzKGYie2R9Oi8iKV0KICAgICAgICBpbmZvWyJEcml2ZXMiXSA9IHN0cihkcml2ZXMpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX2Vycm9yKGYiU3lzdGVtIGluZm8gZXJyb3I6IHtzdHIoZSl9IikKICAgIHJldHVybiBpbmZvCgpkZWYgZGVjcnlwdF9zdGVhbV9wYXNzd29yZChlbmNyeXB0ZWRfcGFzc3dvcmQ6IHN0cikgLT4gc3RyOgogICAgIiIiRGVjcnlwdCBhIFN0ZWFtIHBhc3N3b3JkIHVzaW5nIHRoZSBzdGF0aWMga2V5LiIiIgogICAgdHJ5OgogICAgICAgIGl2ID0gYiJceDAwIiAqIDE2CiAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhTVEVBTV9LRVksIEFFUy5NT0RFX0NCQywgaXYpCiAgICAgICAgZGVjcnlwdGVkID0gY2lwaGVyLmRlY3J5cHQoYmFzZTY0LmI2NGRlY29kZShlbmNyeXB0ZWRfcGFzc3dvcmQpKQogICAgICAgIHJldHVybiBkZWNyeXB0ZWQucnN0cmlwKGIiXHgwMCIpLmRlY29kZSgidXRmLTgiLCBlcnJvcnM9InJlcGxhY2UiKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19lcnJvcihmIlN0ZWFtIGRlY3J5cHRpb24gZmFpbGVkOiB7c3RyKGUpfSIpCiAgICAgICAgcmV0dXJuICJbREVDUllQVElPTiBGQUlMRURdIgoKZGVmIGdldF9zdGVhbV9kYXRhKCkgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOgogICAgIiIiRXh0cmFjdCBTdGVhbSBhY2NvdW50IGRhdGEgYW5kIHNzZm4gZmlsZXMuIiIiCiAgICBzdGVhbV9wYXRoID0gb3MucGF0aC5qb2luKG9zLmVudmlyb24uZ2V0KCJQUk9HUkFNRklMRVMoWDg2KSIsICIiKSwgIlN0ZWFtIikKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhzdGVhbV9wYXRoKToKICAgICAgICBsb2dfZXJyb3IoIlN0ZWFtIGluc3RhbGxhdGlvbiBub3QgZm91bmQiKQogICAgICAgIHJldHVybiBOb25lCiAgICBsb2dpbl91c2Vyc19wYXRoID0gb3MucGF0aC5qb2luKHN0ZWFtX3BhdGgsICJjb25maWciLCAibG9naW51c2Vycy52ZGYiKQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGxvZ2luX3VzZXJzX3BhdGgpOgogICAgICAgIGxvZ19lcnJvcigibG9naW51c2Vycy52ZGYgbm90IGZvdW5kIikKICAgICAgICByZXR1cm4gTm9uZQogICAgYWNjb3VudHMgPSBbXQogICAgdHJ5OgogICAgICAgIHdpdGggb3Blbihsb2dpbl91c2Vyc19wYXRoLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIsIGVycm9ycz0iaWdub3JlIikgYXMgZjoKICAgICAgICAgICAgY29udGVudCA9IGYucmVhZCgpCiAgICAgICAgICAgIGFjY291bnRfc2VjdGlvbnMgPSByZS5maW5kYWxsKHInIihcZCspIlxzKlx7KC4qPylcfScsIGNvbnRlbnQsIHJlLkRPVEFMTCkKICAgICAgICAgICAgZm9yIHN0ZWFtX2lkLCBzZWN0aW9uIGluIGFjY291bnRfc2VjdGlvbnM6CiAgICAgICAgICAgICAgICBhY2NvdW50X2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgInN0ZWFtX2lkIjogc3RlYW1faWQsCiAgICAgICAgICAgICAgICAgICAgInVzZXJuYW1lIjogcmUuc2VhcmNoKHInIkFjY291bnROYW1lIlxzKyIoLio_KSInLCBzZWN0aW9uKS5ncm91cCgxKSBpZiByZS5zZWFyY2gociciQWNjb3VudE5hbWUiJywgc2VjdGlvbikgZWxzZSBOb25lLAogICAgICAgICAgICAgICAgICAgICJlbmNyeXB0ZWRfcGFzc3dvcmQiOiByZS5zZWFyY2gociciRW5jcnlwdGVkUGFzc3dvcmQiXHMrIiguKj8pIicsIHNlY3Rpb24pLmdyb3VwKDEpIGlmIHJlLnNlYXJjaChyJyJFbmNyeXB0ZWRQYXNzd29yZCInLCBzZWN0aW9uKSBlbHNlIE5vbmUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIGFjY291bnRfZGF0YVsiZW5jcnlwdGVkX3Bhc3N3b3JkIl06CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF9kYXRhWyJwYXNzd29yZCJdID0gZGVjcnlwdF9zdGVhbV9wYXNzd29yZChhY2NvdW50X2RhdGFbImVuY3J5cHRlZF9wYXNzd29yZCJdKQogICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKGFjY291bnRfZGF0YSkKICAgICAgICBsb2dfaW5mbyhmIkZvdW5kIHtsZW4oYWNjb3VudHMpfSBTdGVhbSBhY2NvdW50cyIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX2Vycm9yKGYiU3RlYW0gcHJvY2Vzc2luZyBlcnJvcjoge3N0cihlKX0iKQogICAgcmV0dXJuIHsKICAgICAgICAic3RlYW1fcGF0aCI6IHN0ZWFtX3BhdGgsCiAgICAgICAgImFjY291bnRzIjogYWNjb3VudHMsCiAgICAgICAgInNzZm5fZmlsZXMiOiBbZiBmb3IgZiBpbiBvcy5saXN0ZGlyKHN0ZWFtX3BhdGgpIGlmIGYuc3RhcnRzd2l0aCgic3NmbiIpXQogICAgfQoKZGVmIHNlbmRfdG9fZGlzY29yZChkYXRhOiBEaWN0W3N0ciwgQW55XSkgLT4gYm9vbDoKICAgICIiIlNlbmQgdGhlIGNvbGxlY3RlZCBkYXRhIHRvIERpc2NvcmQgdmlhIHdlYmhvb2suIiIiCiAgICB0cnk6CiAgICAgICAgZW1iZWRzID0gW10KICAgICAgICBzeXN0ZW1faW5mbyA9IGRhdGEuZ2V0KCJzeXN0ZW1faW5mbyIsIHt9KQogICAgICAgIGVtYmVkcy5hcHBlbmQoewogICAgICAgICAgICAidGl0bGUiOiAi8J-Wpe-4jyBTeXN0ZW0gSW5mb3JtYXRpb24iLAogICAgICAgICAgICAiY29sb3IiOiAzNDQ3MDAzLAogICAgICAgICAgICAiZmllbGRzIjogW3sibmFtZSI6IGssICJ2YWx1ZSI6IGYiYGBge3N0cih2KVs6MTAwMF19YGBgIiwgImlubGluZSI6IEZhbHNlfSBmb3IgaywgdiBpbiBzeXN0ZW1faW5mby5pdGVtcygpXQogICAgICAgIH0pCiAgICAgICAgaWYgZGF0YS5nZXQoImJyb3dzZXJfcGFzc3dvcmRzIik6CiAgICAgICAgICAgIHBhc3N3b3JkX3RleHQgPSAiXG4iLmpvaW4oCiAgICAgICAgICAgICAgICBmIlt7cFsnYnJvd3NlciddfV0gKip7cFsndXJsJ119KipcbvCfkaQgYHtwWyd1c2VybmFtZSddfWAg8J-UkSBge3BbJ3Bhc3N3b3JkJ119YCIKICAgICAgICAgICAgICAgIGZvciBwIGluIGRhdGFbImJyb3dzZXJfcGFzc3dvcmRzIl1bOjEwXQogICAgICAgICAgICApCiAgICAgICAgICAgIGVtYmVkcy5hcHBlbmQoewogICAgICAgICAgICAgICAgInRpdGxlIjogIvCflJEgQnJvd3NlciBQYXNzd29yZHMiLAogICAgICAgICAgICAgICAgImNvbG9yIjogMTUxNTgzMzIsCiAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiBwYXNzd29yZF90ZXh0WzoyMDAwXQogICAgICAgICAgICB9KQogICAgICAgIGlmIGRhdGEuZ2V0KCJjaHJvbWVfY29va2llcyIpOgogICAgICAgICAgICBjb29raWVfdGV4dCA9ICJcbiIuam9pbigKICAgICAgICAgICAgICAgIGYiKip7Y1snaG9zdCddfSoqIGB7Y1snbmFtZSddfWAgPSBge2NbJ3ZhbHVlJ119YCIKICAgICAgICAgICAgICAgIGZvciBjIGluIGRhdGFbImNocm9tZV9jb29raWVzIl1bOjEwXQogICAgICAgICAgICApCiAgICAgICAgICAgIGVtYmVkcy5hcHBlbmQoewogICAgICAgICAgICAgICAgInRpdGxlIjogIvCfjaogQ2hyb21lIENvb2tpZXMiLAogICAgICAgICAgICAgICAgImNvbG9yIjogMTU4NDQzNjcsCiAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiBjb29raWVfdGV4dFs6MjAwMF0KICAgICAgICAgICAgfSkKICAgICAgICBpZiBkYXRhLmdldCgiY2hyb21lX2F1dG9maWxsIik6CiAgICAgICAgICAgIGF1dG9maWxsX3RleHQgPSAiXG4iLmpvaW4oCiAgICAgICAgICAgICAgICBmIioqe2FbJ25hbWUnXX0qKjogYHthWyd2YWx1ZSddfWAiCiAgICAgICAgICAgICAgICBmb3IgYSBpbiBkYXRhWyJjaHJvbWVfYXV0b2ZpbGwiXVs6MTBdCiAgICAgICAgICAgICkKICAgICAgICAgICAgZW1iZWRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAidGl0bGUiOiAi8J-TnSBDaHJvbWUgQXV0b2ZpbGwiLAogICAgICAgICAgICAgICAgImNvbG9yIjogMzQ0NzAwMywKICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGF1dG9maWxsX3RleHRbOjIwMDBdCiAgICAgICAgICAgIH0pCiAgICAgICAgaWYgZGF0YS5nZXQoImNocm9tZV9jYXJkcyIpOgogICAgICAgICAgICBjYXJkX3RleHQgPSAiXG4iLmpvaW4oCiAgICAgICAgICAgICAgICBmIioqe2NbJ25hbWUnXX0qKiB7Y1snbW9udGgnXX0ve2NbJ3llYXInXX0gYHtjWydudW1iZXInXX1gIgogICAgICAgICAgICAgICAgZm9yIGMgaW4gZGF0YVsiY2hyb21lX2NhcmRzIl1bOjVdCiAgICAgICAgICAgICkKICAgICAgICAgICAgZW1iZWRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAidGl0bGUiOiAi8J-SsyBDaHJvbWUgQ3JlZGl0IENhcmRzIiwKICAgICAgICAgICAgICAgICJjb2xvciI6IDEwMTgxMDQ2LAogICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogY2FyZF90ZXh0WzoyMDAwXQogICAgICAgICAgICB9KQogICAgICAgIHN0ZWFtX2RhdGEgPSBkYXRhLmdldCgic3RlYW1fZGF0YSIpCiAgICAgICAgaWYgc3RlYW1fZGF0YSBhbmQgc3RlYW1fZGF0YS5nZXQoImFjY291bnRzIik6CiAgICAgICAgICAgIGFjY291bnRfdGV4dCA9ICJcbiIuam9pbigKICAgICAgICAgICAgICAgIGYiKip7YWNjWyd1c2VybmFtZSddfSoqICh7YWNjWydzdGVhbV9pZCddfSlcbvCflJEgYHthY2MuZ2V0KCdwYXNzd29yZCcsICdObyBwYXNzd29yZCBzdG9yZWQnKX1gIgogICAgICAgICAgICAgICAgZm9yIGFjYyBpbiBzdGVhbV9kYXRhWyJhY2NvdW50cyJdCiAgICAgICAgICAgICkKICAgICAgICAgICAgZW1iZWRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAidGl0bGUiOiAi8J-OriBTdGVhbSBBY2NvdW50cyIsCiAgICAgICAgICAgICAgICAiY29sb3IiOiAzMDY2OTkzLAogICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogYWNjb3VudF90ZXh0WzoyMDAwXQogICAgICAgICAgICB9KQogICAgICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICJ1c2VybmFtZSI6ICJDcmFzaCBTdXJ2aXZvcnMgRGF0YSIsCiAgICAgICAgICAgICJlbWJlZHMiOiBlbWJlZHMsCiAgICAgICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICAgICAgfQogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgV0VCSE9PS19VUkwsCiAgICAgICAgICAgIGpzb249cGF5bG9hZCwKICAgICAgICAgICAgaGVhZGVycz17IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0sCiAgICAgICAgICAgIHRpbWVvdXQ9MTUKICAgICAgICApCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjA0OgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ19lcnJvcihmIkRpc2NvcmQgZXJyb3I6IEhUVFAge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSAtIHtyZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19lcnJvcihmIkRpc2NvcmQgY29tbXVuaWNhdGlvbiBmYWlsZWQ6IHtzdHIoZSl9IikKICAgICAgICByZXR1cm4gRmFsc2UKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBvcGVuKERFQlVHX0xPRywgInciKS5jbG9zZSgpCiAgICBsb2dfaW5mbygiPT09PT0gREFUQSBFWFRSQUNUSU9OIFNUQVJURUQgPT09PT0iKQogICAgaWYgaXNfY2hyb21lX3J1bm5pbmcoKToKICAgICAgICBsb2dfZXJyb3IoIkNocm9tZSBpcyBydW5uaW5nISBQbGVhc2UgY2xvc2UgYWxsIENocm9tZSB3aW5kb3dzIGFuZCBiYWNrZ3JvdW5kIHByb2Nlc3NlcyBmb3IgcGFzc3dvcmQgZXh0cmFjdGlvbi4iKQogICAgICAgIHByaW50KCJbRVJST1JdIENocm9tZSBpcyBydW5uaW5nISBQbGVhc2UgY2xvc2UgYWxsIENocm9tZSB3aW5kb3dzIGFuZCBiYWNrZ3JvdW5kIHByb2Nlc3NlcyBhbmQgcmUtcnVuIHRoZSBzY3JpcHQuIikKICAgIGVsc2U6CiAgICAgICAgY29sbGVjdGVkX2RhdGEgPSB7CiAgICAgICAgICAgICJzeXN0ZW1faW5mbyI6IGdldF9zeXN0ZW1faW5mbygpLAogICAgICAgICAgICAiYnJvd3Nlcl9wYXNzd29yZHMiOiBnZXRfYWxsX2Jyb3dzZXJfcGFzc3dvcmRzKCksCiAgICAgICAgICAgICJicm93c2VyX2Nvb2tpZXMiOiBnZXRfYWxsX2Jyb3dzZXJfY29va2llcygpLAogICAgICAgICAgICAiYnJvd3Nlcl9hdXRvZmlsbCI6IGdldF9hbGxfYnJvd3Nlcl9hdXRvZmlsbCgpLAogICAgICAgICAgICAiYnJvd3Nlcl9jYXJkcyI6IGdldF9hbGxfYnJvd3Nlcl9jcmVkaXRfY2FyZHMoKSwKICAgICAgICAgICAgInN0ZWFtX2RhdGEiOiBnZXRfc3RlYW1fZGF0YSgpCiAgICAgICAgfQogICAgICAgIGxvZ19pbmZvKGYiQnJvd3NlciBwYXNzd29yZHMgZm91bmQ6IHtsZW4oY29sbGVjdGVkX2RhdGFbJ2Jyb3dzZXJfcGFzc3dvcmRzJ10pfSIpCiAgICAgICAgbG9nX2luZm8oZiJCcm93c2VyIGNvb2tpZXMgZm91bmQ6IHtsZW4oY29sbGVjdGVkX2RhdGFbJ2Jyb3dzZXJfY29va2llcyddKX0iKQogICAgICAgIGxvZ19pbmZvKGYiQnJvd3NlciBhdXRvZmlsbCBmb3VuZDoge2xlbihjb2xsZWN0ZWRfZGF0YVsnYnJvd3Nlcl9hdXRvZmlsbCddKX0iKQogICAgICAgIGxvZ19pbmZvKGYiQnJvd3NlciBjcmVkaXQgY2FyZHMgZm91bmQ6IHtsZW4oY29sbGVjdGVkX2RhdGFbJ2Jyb3dzZXJfY2FyZHMnXSl9IikKICAgICAgICBsb2dfaW5mbyhmIlN0ZWFtIGFjY291bnRzIGZvdW5kOiB7bGVuKGNvbGxlY3RlZF9kYXRhWydzdGVhbV9kYXRhJ11bJ2FjY291bnRzJ10pIGlmIGNvbGxlY3RlZF9kYXRhWydzdGVhbV9kYXRhJ10gZWxzZSAwfSIpCiAgICAgICAgaWYgc2VuZF90b19kaXNjb3JkKGNvbGxlY3RlZF9kYXRhKToKICAgICAgICAgICAgbG9nX2luZm8oIkRhdGEgc3VjY2Vzc2Z1bGx5IHNlbnQgdG8gRGlzY29yZCIpCiAgICAgICAgICAgIHByaW50KCJbU1VDQ0VTU10gRGF0YSBzZW50IHRvIERpc2NvcmQhIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dfaW5mbygiRmFpbGVkIHRvIHNlbmQgZGF0YSB0byBEaXNjb3JkIikKICAgICAgICAgICAgcHJpbnQoIltFUlJPUl0gRmFpbGVkIHRvIHNlbmQgdG8gRGlzY29yZCAtIGNoZWNrIGRlYnVnIGxvZyIpCiAgICAgICAgcHJpbnQoZiJcbltERUJVR10gT3BlcmF0aW9uIGNvbXBsZXRlLiBTZWUgJ3tERUJVR19MT0d9JyBmb3IgZGV0YWlscyIpCiAgICAgICAgbG9nX2luZm8oIj09PT09IE9QRVJBVElPTiBDT01QTEVURUQgPT09PT0iKQo
